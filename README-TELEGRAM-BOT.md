# Telegram Bot для Sadia.lux

## Установка

1. Установите зависимости:
```bash
cd backend
npm install
```

2. Настройте переменные окружения в `.env`:
```
TELEGRAM_BOT_TOKEN=7996833914:AAGuJt600Y7NE8DaDWDmnq18bh3UDgu7jhQ
API_URL=http://localhost:3000/api
FRONTEND_URL=http://localhost:5173
```

3. Запустите:
```bash
# В одном терминале - запустите бэкенд сервер
npm run dev

# В другом терминале - запустите бота
npm run bot
```

## Функционал бота

### Команды:
- `/start` - Главное меню
- `/catalog` - Просмотр каталога товаров
- `/cart` - Просмотр корзины
- `/help` - Помощь

### Возможности для пользователей:

1. **Просмотр категорий** - выбор категории товаров
2. **Просмотр товаров** - список товаров в выбранной категории
3. **Детали товара** - просмотр информации о товаре, фото, цены и доступных размеров
4. **Добавление в корзину** - выбор размера и добавление товара в корзину
5. **Управление корзиной** - просмотр, удаление товаров из корзины
6. **Оформление заказа** - создание заказа через API
7. **Открытие сайта** - кнопка для открытия веб-версии сайта как Telegram Mini App

### Возможности для администраторов (ADMIN/SUPERADMIN):

1. **Админ панель** - доступ к административным функциям
2. **Статистика** - просмотр статистики заказов и доходов
3. **Управление заказами** - открытие админ панели для управления заказами
4. **Управление товарами** - открытие админ панели для управления товарами
5. **Открытие админ панели** - кнопка для открытия веб-версии админ панели как Telegram Mini App

## Роли пользователей

Бот поддерживает следующие роли:
- **USER** - обычный пользователь (доступ к покупкам)
- **ADMIN** - администратор (доступ к админ панели в боте)
- **SUPERADMIN** - суперадминистратор (полный доступ к админ панели)

Роли определяются через API endpoint `/api/telegram/user?telegramUserId={id}`.

## Telegram Mini App

Бот настроен для работы с Telegram Mini App:
- Кнопка "Открыть сайт" открывает веб-версию сайта внутри Telegram
- Кнопка "Открыть админ панель" открывает админ панель внутри Telegram
- Frontend автоматически определяет запуск в Telegram и настраивает интерфейс

### Настройка Mini App:

1. Откройте бота в [@BotFather](https://t.me/BotFather)
2. Отправьте `/mybots`
3. Выберите вашего бота
4. Выберите "Bot Settings" → "Menu Button"
5. Установите URL вашего фронтенда (например: `https://yourdomain.com`)

## API Endpoints

Бот использует следующие API endpoints:
- `GET /api/categories` - получение категорий
- `GET /api/products?categoryId={id}` - получение товаров по категории
- `GET /api/products/{id}` - получение деталей товара
- `GET /api/telegram/inventory?productId={id}` - получение доступных размеров
- `POST /api/telegram/webhook` - создание заказа
- `GET /api/telegram/user?telegramUserId={id}` - получение информации о пользователе и его роли
- `GET /api/admin/analytics/dashboard` - получение статистики (требует авторизацию)

## Настройка

Все настройки бота находятся в файле `bot/telegram-bot.ts`.

Для изменения текста сообщений отредактируйте соответствующие методы класса `SadiaTelegramBot`.
